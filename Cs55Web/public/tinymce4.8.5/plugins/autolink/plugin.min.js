!(function() { 'use strict'; var e = tinymce.util.Tools.resolve('tinymce.PluginManager'), i = tinymce.util.Tools.resolve('tinymce.Env'), m = function(e) { return e.getParam('autolink_pattern', /^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i) }, y = function(e) { return e.getParam('default_link_target', '') }, o = function(e, t) { if (t < 0 && (t = 0), e.nodeType === 3) { var n = e.data.length; n < t && (t = n) } return t }, k = function(e, t, n) { t.nodeType !== 1 || t.hasChildNodes() ? e.setStart(t, o(t, n)) : e.setStartBefore(t) }, p = function(e, t, n) { t.nodeType !== 1 || t.hasChildNodes() ? e.setEnd(t, o(t, n)) : e.setEndAfter(t) }, r = function(e, t, n) { var i, o, r, a, f, s, d, l, c, u, g = m(e), h = y(e); if (e.selection.getNode().tagName !== 'A') { if ((i = e.selection.getRng(!0).cloneRange()).startOffset < 5) { if (!(l = i.endContainer.previousSibling)) { if (!i.endContainer.firstChild || !i.endContainer.firstChild.nextSibling) return; l = i.endContainer.firstChild.nextSibling } if (c = l.length, k(i, l, c), p(i, l, c), i.endOffset < 5) return; o = i.endOffset, a = l } else { if ((a = i.endContainer).nodeType !== 3 && a.firstChild) { for (;a.nodeType !== 3 && a.firstChild;)a = a.firstChild; a.nodeType === 3 && (k(i, a, 0), p(i, a, a.nodeValue.length)) }o = i.endOffset === 1 ? 2 : i.endOffset - 1 - t } for (r = o; k(i, a, o >= 2 ? o - 2 : 0), p(i, a, o >= 1 ? o - 1 : 0), o -= 1, (u = i.toString()) !== ' ' && u !== '' && u.charCodeAt(0) !== 160 && o - 2 >= 0 && u !== n;);var C; (C = i.toString()) === n || C === ' ' || C.charCodeAt(0) === 160 ? (k(i, a, o), p(i, a, r), o += 1) : (i.startOffset === 0 ? k(i, a, 0) : k(i, a, o), p(i, a, r)), (s = i.toString()).charAt(s.length - 1) === '.' && p(i, a, r - 1), (d = (s = i.toString().trim()).match(g)) && (d[1] === 'www.' ? d[1] = 'http://www.' : /@$/.test(d[1]) && !/^mailto:/.test(d[1]) && (d[1] = 'mailto:' + d[1]), f = e.selection.getBookmark(), e.selection.setRng(i), e.execCommand('createlink', !1, d[1] + d[2]), h && e.dom.setAttrib(e.selection.getNode(), 'target', h), e.selection.moveToBookmark(f), e.nodeChanged()) } }, t = function(t) { var n; t.on('keydown', function(e) { e.keyCode !== 13 || r(t, -1, '') }), i.ie ? t.on('focus', function() { if (!n) { n = !0; try { t.execCommand('AutoUrlDetect', !1, !0) } catch (e) {} } }) : (t.on('keypress', function(e) { e.keyCode !== 41 || r(t, -1, '(') }), t.on('keyup', function(e) { e.keyCode !== 32 || r(t, 0, '') })) }; e.add('autolink', function(e) { t(e) }) }())
